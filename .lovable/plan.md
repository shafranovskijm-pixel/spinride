
# План улучшений проекта SPINRIDE

## 1. Исправление безопасности (Высокий приоритет)

### 1.1 Проверка и исправление RLS-политик
- Проанализировать все таблицы на наличие `USING (true)` для операций INSERT/UPDATE/DELETE
- Заменить на корректные политики с проверкой `auth.uid()`
- Особое внимание: таблицы `orders`, `reviews`, `favorites`

### 1.2 Включение защиты от утечённых паролей
- Активировать Leaked Password Protection в настройках аутентификации
- Это предотвратит использование скомпрометированных паролей

## 2. Интеграция офлайн-синхронизации (Средний приоритет)

### 2.1 Подключить `addToSyncQueue` к реальным действиям
Файлы для изменения:
- `src/hooks/use-favorites.tsx` - добавить вызов `addToSyncQueue` при добавлении/удалении избранного в офлайн-режиме
- `src/pages/CheckoutPage.tsx` - сохранять заказ в очередь синхронизации при отсутствии сети

Логика:
```text
При офлайн:
  1. Пользователь добавляет в избранное
  2. Вызывается addToSyncQueue({ type: 'favorite', action: 'add', data: {...} })
  3. При восстановлении сети processQueue() синхронизирует с базой
```

## 3. Динамические категории в админ-панели

### 3.1 Замена захардкоженного списка
Файл: `src/pages/admin/AdminProducts.tsx`
- Удалить статический массив `categories`
- Загружать категории из БД через `useQuery`
- Добавить состояние загрузки для селекта

## 4. Push-уведомления для PWA (Средний приоритет)

### 4.1 Создание edge-функции `send-push`
```text
supabase/functions/send-push/index.ts
├── Получение подписок админов из push_subscriptions
├── Формирование payload для Web Push
├── Отправка через web-push библиотеку
└── Обработка ошибок (удаление невалидных подписок)
```

### 4.2 UI для подписки на уведомления
Файл: `src/pages/admin/AdminSettings.tsx`
- Кнопка "Включить уведомления"
- Запрос разрешения на Notification API
- Сохранение подписки в `push_subscriptions`

### 4.3 Интеграция с оформлением заказа
Файл: `src/pages/CheckoutPage.tsx`
- После успешного создания заказа вызывать `send-push`

**Требуется**: VAPID-ключи (публичный и приватный)

## 5. Улучшение UX (Низкий приоритет)

### 5.1 Валидация телефона
Файл: `src/pages/CheckoutPage.tsx`
- Добавить маску ввода: `+7 (___) ___-__-__`
- Валидация через regex: `/^\+7\s?\(\d{3}\)\s?\d{3}-\d{2}-\d{2}$/`

### 5.2 Автозаполнение формы для авторизованных
- Подтягивать имя и email из профиля пользователя

## 6. Тестовые данные

### 6.1 Создание тестовых отзывов
- Добавить 5-10 отзывов через админ-панель или миграцию

### 6.2 Создание тестового заказа
- Оформить тестовый заказ для проверки воронки

---

## Порядок выполнения

1. **Сначала**: Исправление RLS-политик (безопасность)
2. **Затем**: Динамические категории в админке (быстрое улучшение)
3. **Далее**: Интеграция офлайн-синхронизации (уже готовая инфраструктура)
4. **После**: Push-уведомления (требует VAPID-ключи)
5. **В конце**: UX-улучшения формы заказа

## Техническая сложность

| Задача | Сложность | Время |
|--------|-----------|-------|
| RLS-политики | Средняя | 15-20 мин |
| Динамические категории | Низкая | 10 мин |
| Офлайн-синхронизация | Средняя | 20-30 мин |
| Push-уведомления | Высокая | 40-60 мин |
| Валидация телефона | Низкая | 10 мин |
